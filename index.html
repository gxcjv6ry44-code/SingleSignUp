<!-- File: SingleUserSignup.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Single User Sign Up</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 20px; background:#f6f7f9; }
    .card { max-width: 820px; margin: 0 auto; background: white; padding: 18px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.08); }
    .grid { display:grid; grid-template-columns: 1fr; gap: 12px; }
    .pair { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { font-weight: 700; font-size: 13px; }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
   select {
    padding: 10px;
    border: 1px solid #d8dde6;
    border-radius: 10px;
    width: 100%;
    box-sizing: border-box;
    } 
    .checks { padding: 12px; background:#fafbfc; border:1px solid #e6e9ef; border-radius: 12px; display:grid; gap: 8px; }
    .row { display:flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
    button { padding: 10px 14px; border-radius: 12px; border: 0; font-weight: 800; cursor:pointer; }
    button[type="submit"] { background:#2563eb; color:white; }
    .secondary { background:#e5e7eb; }
    .go { background:#16a34a; color:white; }
    .error { color:#b91c1c; font-size: 12px; min-height: 16px; }
    .hint { font-size: 12px; color:#5b6472; }
    pre { margin-top: 12px; padding: 12px; background:#0b1020; color:#e5e7eb; border-radius: 12px; overflow:auto; }
    @media (max-width: 720px) { .pair { grid-template-columns: 1fr; } }
    a { color: #2563eb; }
   

/* Keep inputs aligned nicely */
.checks input[type="radio"],
.checks input[type="checkbox"] {
 width: auto;
  padding: 0;
  border: 0;
}
/* Only style the appointment-time options (do NOT affect SMS consent block) */
.time-option {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  font-weight: 500;   /* override the global bold label */
  line-height: 1.35;
}

.time-option input[type="radio"] {
  margin-top: 2px;
  flex: 0 0 auto;
}

.time-option span {
  display: inline-block;
}
/* Appointment time radio rows only */
.time-row{
  display:flex;
  align-items:flex-start;
  gap:10px;
}

.time-row input[type="radio"]{
  margin-top: 2px;
}

.time-text{
  font-weight: 500;   /* overrides your global bold label */
  font-size: 13px;
  line-height: 1.35;
  color: #111;        /* force visible text */
  cursor: pointer;
}
  </style>
</head>

<body>
  <div class="card">
    <h2>Sign Up</h2>
    <div class="hint">This form submits to Make and prints the JSON below.</div>

    <form id="signupForm" novalidate>
      <div class="grid" style="margin-top:12px;">
        <div>
          <label for="fullName">Full name *</label><br/>
          <input id="fullName" name="fullName" maxlength="120" autocomplete="name" />
          <div class="error" id="errName"></div>
        </div>

        <div>
          <label for="phone">Phone *</label><br/>
          <input id="phone" name="phone" placeholder="801-555-1234" autocomplete="tel" />
          <div class="error" id="errPhone"></div>
        </div>

        <div>
          <label for="email">Email *</label><br/>
          <input id="email" name="email" type="email" maxlength="120" placeholder="you@example.com" autocomplete="email" />
          <div class="error" id="errEmail"></div>
        </div>

        <div class="pair">
          <div>
            <label for="stake">Stake *</label><br/>
            <select id="stake" name="stake">
              <option value="">Select a stake…</option>
            </select>
            <div class="error" id="errStake"></div>
          </div>

          <div>
            <label for="ward">Ward *</label><br/>
            <select id="ward" name="ward" disabled>
              <option value="">Choose a stake first…</option>
            </select>
            <div class="error" id="errWard"></div>
          </div>
        </div>

        <div>
          <label for="date">Date *</label><br/>
          <input id="date" name="date" type="date" />
          <div class="hint" id="dateHint">Choose any future date.</div>
          <div class="error" id="errDate"></div>
        </div>
      </div>

   <div style="margin-top:14px;">
  <label>Appointment time *</label>

  <div class="checks" role="radiogroup" aria-label="Appointment time">
    <div class="time-row">
      <input type="radio" id="tsAM" name="timeSlot" value="AM Volunteer" />
      <label for="tsAM" class="time-text">AM Volunteer (8:30–10:30 AM)</label>
    </div>

    <div class="time-row">
      <input type="radio" id="tsPM" name="timeSlot" value="PM Volunteer" />
      <label for="tsPM" class="time-text">PM Volunteer (5:00–7:00 PM)</label>
    </div>

    <div class="time-row">
      <input type="radio" id="tsYN" name="timeSlot" value="Youth Night" />
      <label for="tsYN" class="time-text">Youth Night (Wednesdays 6:30–8:00 PM)</label>
    </div>

    <div class="error" id="errTime"></div>
  </div>
</div>

      <div style="margin-top:14px;">
        <label>Text message consent (optional)</label>
        <div class="checks">
          <label style="font-weight: 500; line-height: 1.35;">
            <input id="smsOptIn" name="smsOptIn" type="checkbox" />
            I agree to receive messages from North Ogden Orchard sent via an autodialer, and this agreement isn’t a condition of any purchase.
            I also agree to the
            <a href="https://northogdenorchard.net/terms-conditions-and-privacy-policy" target="_blank" rel="noopener noreferrer">Terms of Service and Privacy Policy</a>.
            Approx. 4 msgs/month. Msg &amp; Data rates may apply.
            Text <strong>STOP</strong> to opt-out. Text <strong>HELP</strong> for assistance.
            By submitting this form, I agree that my mobile information will not be shared with third parties/affiliates
            for marketing or promotional purposes. All the above categories exclude text messaging originator opt-in data
            and consent; this information will not be shared with any third parties, except for the necessary opt-in data
            required to facilitate the SMS service.
          </label>
        </div>
      </div>

      <div class="row">
        <button type="submit">Submit</button>
        <button type="button" class="secondary" id="resetBtn">Reset</button>
        <button type="button" class="go" id="orchardBtn">Go to North Ogden Orchard</button>
        <div class="hint" id="successMsg" style="align-self:center; font-weight:700;"></div>
        <div class="error" id="errSubmit" style="align-self:center;"></div>
      </div>
    </form>

    <pre id="output">{}</pre>
  </div>

  <script>
    /***********************
     * CONFIG
     ***********************/
    const MAKE_WEBHOOK_URL = "https://hook.us2.make.com/p051xaxanggdra1jycntxjduaq6l9nsa";
    const SEND_TO_MAKE = true; // set false to test without sending

    /***********************
     * STAKE/WARD DATA
     * (Replace with your real stakes/wards)
     ***********************/
    const STAKE_WARDS = {
      BenLomond: ["Ward 1", "Ward 2", "Ward 3"],
      PlainCity: ["North", "Central", "South"],
      FarrWest: ["A", "B", "C", "D"],
      MountLewis: ["Red", "Blue", "Green"],
      EastRidge: ["Hills", "Valley", "Lake"]
    };

    /***********************
     * ELEMENTS
     ***********************/
    const form = document.getElementById("signupForm");
    const out = document.getElementById("output");
    const successMsg = document.getElementById("successMsg");

    const fullNameEl = document.getElementById("fullName");
    const phoneEl = document.getElementById("phone");
    const emailEl = document.getElementById("email");

    const stakeEl = document.getElementById("stake");
    const wardEl = document.getElementById("ward");

    const dateEl = document.getElementById("date");
    const dateHint = document.getElementById("dateHint");

    const resetBtn = document.getElementById("resetBtn");
    const orchardBtn = document.getElementById("orchardBtn");
    const smsOptInEl = document.getElementById("smsOptIn");

    function setError(id, msg) {
      const el = document.getElementById(id);
      if (el) el.textContent = msg || "";
    }

    function clearErrors() {
      ["errName","errPhone","errEmail","errStake","errWard","errDate","errTime","errSubmit"].forEach(id => setError(id, ""));
      if (successMsg) successMsg.textContent = "";
    }

    function normalizePhone(raw) {
      const digits = (raw || "").replace(/\D/g, "");
      if (digits.length === 10) return digits;
      if (digits.length === 11 && digits.startsWith("1")) return digits.slice(1);
      return null;
    }

    function getSelectedTime() {
      const checked = document.querySelector('input[name="timeSlot"]:checked');
      return checked ? checked.value : null;
    }

    function parseLocalDate(yyyyMmDd) {
      if (!yyyyMmDd) return null;
      const [y,m,d] = yyyyMmDd.split("-").map(Number);
      return new Date(y, m - 1, d);
    }

    function isWednesday(d) { return d && d.getDay() === 3; }

    function toYyyyMmDd(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${dd}`;
    }

    function nextWednesday(fromDate) {
      const d = new Date(fromDate.getFullYear(), fromDate.getMonth(), fromDate.getDate());
      const diff = (3 - d.getDay() + 7) % 7;
      d.setDate(d.getDate() + diff);
      return d;
    }

    function applyYouthNightRulesIfNeeded() {
      const timeSlot = getSelectedTime();
      const isYouth = timeSlot === "Youth Night";

      dateHint.textContent = isYouth
        ? "Youth Night is Wednesdays only."
        : "Choose any future date.";

      if (!isYouth) return;

      const current = parseLocalDate(dateEl.value);
      const base = current || new Date();
      const nextWed = nextWednesday(base);

      if (!current || !isWednesday(current)) {
        dateEl.value = toYyyyMmDd(nextWed);
      }
    }

    // Populate Stake dropdown
    Object.keys(STAKE_WARDS).forEach(s => {
      const opt = document.createElement("option");
      opt.value = s;
      opt.textContent = s;
      stakeEl.appendChild(opt);
    });

    // Stake -> Ward
    stakeEl.addEventListener("change", () => {
      wardEl.innerHTML = "";
      wardEl.value = "";

      if (!stakeEl.value) {
        wardEl.disabled = true;
        wardEl.innerHTML = "<option value=''>Choose a stake first…</option>";
        return;
      }

      wardEl.disabled = false;
      wardEl.innerHTML = "<option value=''>Select a ward…</option>";

      (STAKE_WARDS[stakeEl.value] || []).forEach(w => {
        const opt = document.createElement("option");
        opt.value = w;
        opt.textContent = w;
        wardEl.appendChild(opt);
      });
    });

    // Youth Night rules
    document.querySelectorAll('input[name="timeSlot"]').forEach(r => {
      r.addEventListener("change", applyYouthNightRulesIfNeeded);
    });

    dateEl.addEventListener("change", () => {
      if (getSelectedTime() === "Youth Night") {
        const d = parseLocalDate(dateEl.value);
        if (d && !isWednesday(d)) {
          dateEl.value = toYyyyMmDd(nextWednesday(d));
        }
      }
    });

    // No past dates
    dateEl.min = toYyyyMmDd(new Date());

    orchardBtn.addEventListener("click", () => {
      window.location.href = "https://northogdenorchard.net";
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearErrors();

      const fullName = fullNameEl.value.trim();
      const phoneRaw = phoneEl.value.trim();
      const email = emailEl.value.trim().toLowerCase();

      const stake = stakeEl.value;
      const ward = wardEl.value;
      const dateStr = dateEl.value;

      const timeSlot = getSelectedTime();
      let ok = true;

      if (!fullName) { setError("errName", "Name is required."); ok = false; }

      const phone = normalizePhone(phoneRaw);
      if (!phone) { setError("errPhone", "Enter a valid US phone number (10 digits)."); ok = false; }

      if (!email) { setError("errEmail", "Email is required."); ok = false; }
      else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { setError("errEmail", "Enter a valid email address."); ok = false; }

      if (!stake) { setError("errStake", "Please select a stake."); ok = false; }
      if (!ward) { setError("errWard", "Please select a ward."); ok = false; }
      if (!dateStr) { setError("errDate", "Please choose a date."); ok = false; }

      if (!timeSlot) { setError("errTime", "Please select a time slot."); ok = false; }

      if (timeSlot === "Youth Night" && dateStr) {
        const d = parseLocalDate(dateStr);
        if (!isWednesday(d)) {
          setError("errDate", "Youth Night is Wednesdays only. Please choose a Wednesday.");
          ok = false;
        }
      }

      if (!ok) return;

      // You can change these later as needed
      const timeRange =
        timeSlot === "AM Volunteer" ? "8:30–10:30 AM" :
        timeSlot === "PM Volunteer" ? "5:00–7:00 PM" :
        "Wednesdays 6:30–8:00 PM";

      // IMPORTANT: include opt-in checkbox value in JSON payload
      const smsOptIn = smsOptInEl ? smsOptInEl.checked : false;

      const payload = {
        fullName,
        phone,
        email,
        stake,
        ward,
        date: dateStr,
        timeSlot,
        timeRange,
        smsOptIn
      };

      out.textContent = JSON.stringify(payload, null, 2);

      const canSend = SEND_TO_MAKE && MAKE_WEBHOOK_URL.trim().length > 0 && !MAKE_WEBHOOK_URL.includes("PASTE_");
      if (canSend) {
        try {
          const resp = await fetch(MAKE_WEBHOOK_URL.trim(), {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          if (!resp.ok) throw new Error(`Make error ${resp.status}`);
          successMsg.textContent = "Submitted ✓";
        } catch (err) {
          console.error(err);
          setError("errSubmit", "Send to Make failed. Check webhook URL and Make \"Run once\".");
        }
      } else {
        successMsg.textContent = "Submitted ✓ (not sent — webhook URL not set)";
      }
    });

    resetBtn.addEventListener("click", () => {
      form.reset();
      clearErrors();
      out.textContent = "{}";
      wardEl.disabled = true;
      wardEl.innerHTML = "<option value=''>Choose a stake first…</option>";
      dateHint.textContent = "Choose any future date.";
    });
  </script>
</body>
</html>
